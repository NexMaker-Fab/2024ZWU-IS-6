<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interfacing Arduino with Processing</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }
        pre {
            background-color: #f4f4f4;
            border: 1px solid #ccc;
            padding: 10px;
            overflow: auto;
        }
    .comment {
        color: #6a9955; /* 绿色 */
    }
    .keyword {
        color: #0000ff; /* 蓝色 */
    }
    .number {
        color: #ff00ff; /* 品红色 */
    }
    .function {
        color: #d6336c; /* 紫红色 */
    }
    .string {
        color: #a31515; /* 暗红色 */
    }
</style>
    </style>
</head>
<body>
    <h1>Interfacing Arduino with Processing</h1>
    <p>This guide demonstrates how to interface an Arduino with Processing to visualize data from an HC-SR04 ultrasonic sensor by animating a flower's opening and closing based on distance measurements.</p>

    <h2>Components Needed</h2>
    <ul>
        <li>Arduino Nano or any comparable Arduino board</li>
        <li>HC-SR04 Ultrasonic Sensor</li>
        <li>Jumper wires</li>
        <li>Breadboard</li>
        <li>USB Cable</li>
    </ul>

    <h2>Arduino Wiring</h2>
    <p>Connect the components as follows:</p>
    <ul>
        <li>HC-SR04 VCC to Arduino Nano 5V</li>
        <li>HC-SR04 GND to Arduino Nano GND</li>
        <li>HC-SR04 Trig to Arduino Nano Digital Pin 9</li>
        <li>HC-SR04 Echo to Arduino Nano Digital Pin 10</li>
    </ul>

    <h2>Arduino Code</h2>
    <pre>
        <code>
            <span class="comment">// Define pins for the ultrasonic sensor</span>
            <span class="keyword">const int</span> trigPin = <span class="number">9</span>;
            <span class="keyword">const int</span> echoPin = <span class="number">10</span>;

            <span class="comment">// Initialize variables for duration and distance</span>
            <span class="keyword">long</span> duration;
            <span class="keyword">int</span> distance;

            <span class="function">void setup</span>() {
                <span class="comment">// Set up the input and output pins</span>
                <span class="function">pinMode</span>(trigPin, <span class="keyword">OUTPUT</span>);
                <span class="function">pinMode</span>(echoPin, <span class="keyword">INPUT</span>);
                <span class="comment">// Start serial communication at 9600 baud</span>
                <span class="function">Serial.begin</span>(<span class="number">9600</span>);
            }

            <span class="function">void loop</span>() {
                <span class="comment">// Clear the trigPin</span>
                <span class="function">digitalWrite</span>(trigPin, <span class="keyword">LOW</span>);
                <span class="function">delayMicroseconds</span>(<span class="number">2</span>);

                <span class="comment">// Set the trigPin high for 10 microseconds</span>
                <span class="function">digitalWrite</span>(trigPin, <span class="keyword">HIGH</span>);
                <span class="function">delayMicroseconds</span>(<span class="number">10</span>);
                <span class="function">digitalWrite</span>(trigPin, <span class="keyword">LOW</span>);

                <span class="comment">// Read the echoPin, return the sound wave travel time in microseconds</span>
                duration = <span class="function">pulseIn</span>(echoPin, <span class="keyword">HIGH</span>);

                <span class="comment">// Calculate the distance based on the echo time</span>
                distance = duration * <span class="number">0.034</span> / <span class="number">2</span>; <span class="comment">// Speed of sound division by 2 (round trip)</span>

                <span class="comment">// Send distance to the serial port</span>
                <span class="function">Serial.println</span>(distance); <span class="comment">// This will be read by Processing</span>

                <span class="comment">// Short delay before next reading</span>
                <span class="function">delay</span>(<span class="number">10</span>);
            }
        </code>
    </pre>

    <h2>Processing Code</h2>
<pre>
    <code>
        <span class="keyword">import</span> processing.serial.*; <span class="comment">// 导入串行库</span>

        <span class="keyword">Serial</span> myPort;              <span class="comment">// 创建一个串行对象</span>
        <span class="keyword">int</span> distance;               <span class="comment">// 用于存储接收到的距离的变量</span>
        <span class="keyword">float</span> smoothDistance = <span class="number">0</span>;   <span class="comment">// 平滑后的距离值初始化</span>
        <span class="keyword">float</span> flowerOpenness = <span class="number">0</span>;   <span class="comment">// 表示花朵开放的程度</span>

        <span class="comment">// 平滑算法参数</span>
        <span class="keyword">float</span> alpha = <span class="number">0.5</span>;          <span class="comment">// 平滑系数，0-1之间</span>

        <span class="function">void setup</span>() {
          <span class="function">size</span>(<span class="number">600</span>, <span class="number">600</span>);
          <span class="function">background</span>(<span class="number">255</span>);

          <span class="comment">// 在控制台列出所有可用的串行端口</span>
          <span class="function">printArray</span>(<span class="function">Serial.list</span>());

          <span class="comment">// 打开与你的Arduino相对应的端口</span>
          myPort = <span class="keyword">new</span> <span class="keyword">Serial</span>(<span class="keyword">this</span>, <span class="function">Serial.list</span>()[<span class="number">0</span>], <span class="number">9600</span>);

          <span class="comment">// 清除缓冲区以删除任何不需要的数据</span>
          myPort.<span class="function">clear</span>();

          <span class="comment">// 等待接收串行数据直到换行符'\n'</span>
          myPort.<span class="function">bufferUntil</span>('<span class="string">\n</span>');
        }

        <span class="function">void draw</span>() {
          <span class="function">background</span>(<span class="number">255</span>);
          <span class="function">drawFlower</span>(<span class="function">width</span>/<span class="number">2</span>, <span class="function">height</span>/<span class="number">2</span>, flowerOpenness);
        }

        <span class="comment">// 绘制花朵的函数</span>
        <span class="function">void drawFlower</span>(<span class="keyword">float</span> x, <span class="keyword">float</span> y, <span class="keyword">float</span> openness) {
          <span class="comment">// 使用循环绘制花瓣，这些花瓣基于花朵开放值</span>
          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">8</span>; i++) {
            <span class="keyword">float</span> angle = <span class="function">PI</span>/<span class="number">4</span> * i;
            <span class="keyword">float</span> petalLength = <span class="number">100</span> + openness / <span class="number">2</span>; <span class="comment">// 开放度影响花瓣长度</span>
            <span class="keyword">float</span> petalWidth = <span class="number">50</span> + openness / <span class="number">4</span>;   <span class="comment">// 开放度影响花瓣宽度</span>
            <span class="function">pushMatrix</span>();
            <span class="function">translate</span>(x, y);
            <span class="function">rotate</span>(angle);
            <span class="function">ellipse</span>(<span class="number">0</span>, <span class="number">0</span>, petalLength, petalWidth);
            <span class="function">popMatrix</span>();
          }

          <span class="comment">// 绘制花朵的中心</span>
          <span class="function">fill</span>(<span class="number">255</span>, <span class="number">204</span>, <span class="number">0</span>);
          <span class="function">ellipse</span>(x, y, <span class="number">50</span> + openness / <span class="number">8</span>, <span class="number">50</span> + openness / <span class="number">8</span>);
        }

        <span class="comment">// 当串行端口上有新数据可用时调用的函数</span>
        <span class="function">void serialEvent</span>(<span class="keyword">Serial</span> myPort) {
          <span class="comment">// 读取串行端口</span>
          <span class="keyword">String</span> inString = myPort.<span class="function">readStringUntil</span>('<span class="string">\n</span>');

          <span class="keyword">if</span> (inString != <span class="keyword">null</span>) {
            <span class="comment">// 从字符串中去掉回车和换行符</span>
            inString = <span class="function">trim</span>(inString);

            <span class="keyword">try</span> {
              <span class="comment">// 将字符串转换为整数</span>
              distance = <span class="function">int</span>(inString);

              <span class="comment">// 使用平滑算法计算平滑后的距离</span>
              smoothDistance = alpha * distance + (<span class="number">1</span> - alpha) * smoothDistance;

              <span class="comment">// 将平滑后的距离映射到花朵的开放度</span>
              flowerOpenness = <span class="function">map</span>(smoothDistance, <span class="number">10</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">300</span>); <span class="comment">// 根据你的设置调整数值</span>
            } 
            <span class="keyword">catch</span>(<span class="function">NumberFormatException</span> e) {
              <span class="comment">// 如果字符串格式存在错误，这里进行捕获错误。</span>
            }
          }
        }
    </code>
</pre>
    <h2>Demo Animation</h2>
    <p>This is a real shot of the arduino wiring diagram:</p>
    <img src="https://cdn.jsdelivr.net/gh/y20522/image-cloud/img/219072bc28c351bf33d8cdf0184bb1b.jpg" alt="Demo Animation" style="max-width: 100%; height: auto;">

    <p>This is the processing interface diagram:</p>
    <img src="https://cdn.jsdelivr.net/gh/y20522/image-cloud/img/a9a44f776710fe6c33b5999dfed2246.png" alt="Demo Animation" style="max-width: 100%; height: auto;">


    <p>This animated GIF demonstrates the expected outcome when the ultrasonic sensor detects an object:</p>
    <img src="https://cdn.jsdelivr.net/gh/y20522/image-cloud/img/463fa63f54c8c7145c84ca9aa1722615.gif" alt="Demo Animation" style="max-width: 100%; height: auto;">
</body>
</html>